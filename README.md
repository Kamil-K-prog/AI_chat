# Проект "AI чат"

### Что это?

Это обёртка для чата с нейросетью, заточенная на использование инструментов.

В будущем будет использована как основа для полноценной текстовой D&D игры

### Про универсальный формат хранения истории сообщений

Разные библиотеки используют разный формат хранения сообщений. Дабы это унифицировать и привести в удобный вид, в программе используется упрощённый (оставлены только самые необходимые данные для истории чата) формат, который коротко я называю УФС - Универсальный Формат Сообщений

В этом формате программа хранит историю сообщений. УФС может включать в себя также и медиаформаты (изображения, видео, аудио). Поддержки файлов (.pdf и прочих) **нет**

Как происходит цикл работы с моделью (любой тип):

1.  У экземпляра класса вызывается метод `generate()`, в который подаётся история в УФС, и (опционально) описания инструментов и сами объекты функций
2.  Метод `generate()` конвертирует сообщения в "родной" формат с помощью модуля `converters`
3.  (Опционально) производит пост-процессинг (если в истории есть большие файлы, то загружает их в облако и обращается к ним по URI)
4.  Совершает запрос к API
5.  (Опционально) производит цикл вызова инструментов
6.  Возвращает:
    1. Дельту в УФС (сообщения, сгенерированные в этом раунде)
    2. Новую полную историю сообщений

Другие части программы (GUI) дальше сами обрабатывают дельту, а на вход с новым запросом подают дополненную историю сообщений из п. 6.1.

### Структура файлов

- `main.py` - точка входа в программу
- `config.py` - классы pydantic_settings для удобного доступа к переменным окружения в коде
- `.env.example`
- **Образец/** - файл с примером структуры УФС
- **models/** - классы AI моделей

  - `__init__.py`
  - `base_model.py` - абстрактный базовый класс, обеспечивает бесшовный переход не только между моделями, но и типами (genai, openai) моделей
  - `openai_base_model.py` - наследник базового класса, содержит общие методы для OpenAI библиотеки
  - `genai_base_model.py` - наследник базового класса, содержит общие методы для Genai библиотеки (_genai умеет обрабатывать цепочки вызовов инструментов автоматически, но мне нужно вытаскивать и документировать каждый вызов, чтобы документировать его, так что здесь будет кастомный обработчик состояния цепочки вызовов_)
  - **genai/** - GenAI-совместимые модели
    - `gemini.py` - здесь модели от Google, наследник GenaiBaseModel
  - **openai/** - OpenAI-совместимые модели
    - `deepseek.py`, `chatgpt.py`, `qwen.py`, прочие - модели от DeepSeek OpenAI, Qwen и прочие, наследники OpenaiBaseModel

- **utils/** - вспомогательные библиотеки

  - `__init__.py`
  - `tools.py` - здесь определены функции, которые будут поданы модели как "tools". _Технически, ничто не ограничивает вас, и вы можете зарегистрировать функцию и из другого файла, но вы же не будете так делать?_
  - **converters/** - конвертеры из УФС в совместимый для разных моделей
    - `__init__.py`
    - `converters.py`
  - **tools_parser/** - парсер инструментов
    - `__init__.py`
    - `tools_parser.py` - парсит инструменты в формате JSON, может возвращать как JSON-схему для OpenAI-наследуемых моделей, так и объекты для Genai-наследуемых моделей.
      - Два главных метода:
        - get_tools_scheme_genai - возвращает объекты для Genai-наследуемых моделей
        - get_tools_json_openai - возвращает JSON-схему для OpenAI-наследуемых моделей
      - Также здесь определена функция-декоратор register_tool, которая добавляет функцию в "пул функций", из которого будет происходить парсинг. **Пример использования в `tools.py`**
  - **types/** - pydantic-модели, хелперы для структуры универсального формата
    - `__init__.py`
    - `types.py`

- **gui/**

  - `__init__.py`
  - `main_window.py` - основное окно программы

- **web_api_wrapper/** - **Возможно будет реализовано, до тех пор стандартные эндпоинты**
  - `__init__.py`
  - `web_api_wrapper.py` - превращает aistudio.google.com, deepseek.com и прочие сайты в API-эндпоинты для обращения к нейросетям, так как по API лимиты не очень большие.
